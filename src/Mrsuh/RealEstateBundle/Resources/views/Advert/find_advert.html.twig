{% extends "MrsuhRealEstateBundle::layout.html.twig" %}
{% block content %}

    {{ form_start(form) }}

    <div class="regular_search">
        <div class="row">
            <div class="col-md-3">{{ form_widget(form.search_string_type, {'attr': {'class': 'form-control' }}) }}</div>
            <div class="col-md-3">{{ form_widget(form.search_string_string, {'attr': {'class': 'form-control' }}) }}</div>
            <div class="col-md-2">{{ form_widget(form.search_string, {'attr': {'class': 'btn btn-success' }}) }}</div>
            <div class="col-md-4 pull-right"><button type="button" class="btn btn-primary" id="extension_button">Расширенный поиск</button><br><br></div>
        </div>
    </div>
    <div id="extension_search" hidden="true">
        <div class="row">
            <div class="col-md-3">

                <div class="row">
                    <div class="col-md-12"><label>Тип объекта</label></div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        {% for form in form.object_type %}
                            {{ form_widget(form) }}
                            {{ form_label(form) }}<br>
                        {% endfor %}
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-12"><label>Состояние объекта</label></div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        {% for form in form.object_state %}
                            {{ form_widget(form) }}
                            {{ form_label(form) }}<br>
                        {% endfor %}
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-12"><label>Материал стен дома</label></div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        {% for form in form.object_wall %}
                            {{ form_widget(form) }}
                            {{ form_label(form) }}<br>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-4"><label>Регион</label></div>
                    <div class="col-md-8">{{ form_widget(form.object_region, {'attr': {'class': 'form-control' }}) }}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Город</label></div>
                    <div class="col-md-8">{{ form_widget(form.object_city, {'attr': {'class': 'form-control' }}) }}</div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-4"><label>Регион города</label></div>
                    <div class="col-md-8">
                        {% for form in form.object_region_city %}
                            {{ form_widget(form) }}
                            {{ form_label(form) }}<br>
                        {% endfor %}

                    </div>
                </div>
                <br>
            </div>

            <div class="col-md-4">
                <div class="row">
                    <div class="col-md-4"><label>Цена</label></div>
                    <div class="col-md-4">{{ form_widget(form.price_from, {'attr': {'class': 'form-control' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.price_to, {'attr': {'class': 'form-control' }}) }}</div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-4"><label>Стоимость квадратного метра</label></div>
                    <div class="col-md-4">{{ form_widget(form.meter_price_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.meter_price_to, {'attr': {'class': 'form-control date' }})}}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Число комнат</label></div>
                    <div class="col-md-4">{{ form_widget(form.room_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.room_to, {'attr': {'class': 'form-control date' }}) }}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Общая площадь</label></div>
                    <div class="col-md-4">{{ form_widget(form.common_area_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.common_area_to, {'attr': {'class': 'form-control date' }})}}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Жилая площадь</label></div>
                    <div class="col-md-4">{{ form_widget(form.live_area_from, {'attr': {'class': 'form-control date' }})}}</div>
                    <div class="col-md-4">{{ form_widget(form.live_area_to, {'attr': {'class': 'form-control date' }}) }}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Площадть кухни</label></div>
                    <div class="col-md-4">{{ form_widget(form.kitchen_area_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.kitchen_area_to, {'attr': {'class': 'form-control date' }})}}
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Земельный участок</label></div>
                    <div class="col-md-4">{{ form_widget(form.section_area_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.section_area_to, {'attr': {'class': 'form-control date' }})}}
                    </div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Этаж</label></div>
                    <div class="col-md-4">{{ form_widget(form.floor_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.floor_to, {'attr': {'class': 'form-control date' }}) }}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Количество этажей</label></div>
                    <div class="col-md-4">{{ form_widget(form.floors_from, {'attr': {'class': 'form-control date' }}) }}</div>
                    <div class="col-md-4">{{ form_widget(form.floors_to, {'attr': {'class': 'form-control date' }}) }}</div>
                </div>
                <br>

                <div class="row">
                    <div class="col-md-4"><label>Год постройки</label></div>
                    <div class="col-md-4">{{ form_widget(form.build_year_from, {'attr': {'class': 'form-control date' }})}}</div>
                    <div class="col-md-4">{{ form_widget(form.build_year_to, {'attr': {'class': 'form-control date' }})}}
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-1">{{ form_widget(form.object_not_first_floor) }}</div>
                    <div class="col-md-5"><label>Не первый этаж</label></div>
                    <div class="col-md-1">{{ form_widget(form.object_not_last_floor) }}</div>
                    <div class="col-md-5"><label>Не последний этаж</label></div>
                </div>
                <br>
            </div>
        </div>
        <br>
        {{ form_widget(form.search_extension, {'attr': {'class': 'btn btn-success' }}) }}
    </div>
    <hr>

    {{ form_end(form) }}
    <br>

    {% if adverts %}
    <table class="table table-bordered">
        <tr class="text-center">
            <td>id</td>
            <td>Фото</td>
            <td>Тип объекта</td>
            <td>
                Город
                Район
                Адрес
                Описание
            </td>
            <td>Площадь</td>
            <td>Цена</td>
            <td>Состояние</td>
            <td>
                Создано
                Обновлено
                Истекает
            </td>
        </tr>
        {% for advert in adverts %}
            {% if constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_ACTIVE') == advert.status %}
                <tr class="success">
            {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_REQUEST_DELETE') == advert.status %}
                <tr class="danger">
            {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_DELETED') == advert.status %}
                <tr class="danger">
            {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_AGENT') == advert.status %}
                <tr class="warning">
            {% else %}
                <tr>
            {% endif %}

            <td class="text-center"><a href="{{ url('advert', { 'id': advert.id }) }}">{{ advert.id }}</a></td>
            <td class="img-responsive text-center">
                {% if (advert.getImg | first) != null %}
                    <a href="{{ url('advert', { 'id': advert.id }) }}"><img src="{{ asset( (advert.getImg | first).getMiniWebPath ) }}" style="max-width: 100px; max-height: 100px"></a>
                {% endif %}

            </td>
            <td class="text-center">
                {% if constant('Mrsuh\\RealEstateBundle\\C::OBJECT_TYPE_HOUSE') == advert.object.type.name %}
                    {% if advert.object.roomNumber %} {{ advert.object.roomNumber }} -к {% endif %}
                    {{ advert.object.type.name }}<br>
                    {{ advert.object.floor }} / {{ advert.object.floors }} -эт.  {{ advert.object.wall.name }} Дом
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::OBJECT_TYPE_EARTH_AREA') == advert.object.type.name %}
                    {{ advert.object.type.name }}
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::OBJECT_TYPE_FLAT') == advert.object.type.name %}
                    {{ advert.object.type.name }}
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::OBJECT_TYPE_COMMERCE') == advert.object.type.name %}
                    {{ advert.object.type.name }}
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::OBJECT_TYPE_ROOM') == advert.object.type.name %}
                    {{ advert.object.type.name }}
                {% endif %}
            </td>
            <td class="text-center">
                {{ advert.object.city.name }},{{ advert.object.regionCity.name }},<br>
                {{ advert.object.street.name }} ул {% if advert.object.house %},{{ advert.object.house }}{% endif %}

            </td>
            <td class="text-center">
                {{ advert.object.commonArea }} / {{ advert.object.liveArea }} / {{ advert.object.kitchenArea }} м<sup>2</sup>
            </td>
            <td class="text-center">
                <div class="row">
                    <div class="col-md-12">
                        {{ advert.price }} р
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        ({{ advert.meterPrice }} р/м<sup>2</sup>)
                    </div>
                </div>
            </td>
            <td class="text-center">
                {% if constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_ACTIVE') == advert.status %}
                    активное
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_REQUEST_DELETE') == advert.status %}
                    запрос<br>
                    на удаление
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_DELETED') == advert.status %}
                    удалено
                {% elseif constant('Mrsuh\\RealEstateBundle\\C::STATUS_ADVERT_AGENT') == advert.status %}
                    агент
                {% endif %}
            </td>
            <td class="text-center">
                <div class="row">
                    <div class="col-md-12">
                        {{ advert.user.lastName}} {{ advert.user.firstName}} {{ advert.user.middleName}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <b>Истекает:</b> {{ advert.expireTime|date("d.m.Y") }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <b>Обновлено:</b> {{ advert.updateTime|date("d.m.Y") }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <b>Создано:</b> {{ advert.createTime|date("d.m.Y") }}
                    </div>
                </div>
            </td>
            </tr>
        {% endfor %}
    </table>
        {% else %}
        Запрос не дал результатов...
        {% endif %}
{% endblock %}

{% block js %}
    <script>
        $(function () {
            var extension_button = $('#extension_button');
            var extension_search = $('#extension_search');

            extension_button.click(function () {
                if (extension_search.is(':hidden')) {
                    extension_search.show('slow')
                } else {
                    extension_search.hide('slow')
                }
            });
        });
    </script>

{% endblock %}